<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gloria的輕小說情境圖創建</title>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/png;base64,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">
  
  <!-- Scripts for React, ReactDOM, Babel and Tailwind CSS -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900">
  <div id="root"></div>

  <!-- React Application Script -->
  <script type="text/babel">
    const { useState } = React;

    // Main App Component
    function App() {
      const [prompt, setPrompt] = useState('');
      const [loading, setLoading] = useState(false);
      const [imageUrl, setImageUrl] = useState('');
      const [optimizedPrompt, setOptimizedPrompt] = useState('');
      const [error, setError] = useState('');

      // Function to handle the image generation process
      const handleGenerate = async () => {
        if (!prompt) {
          setError('請先輸入您的封面想法！');
          return;
        }
        setError('');
        setLoading(true);
        setImageUrl('');
        setOptimizedPrompt('');

        try {
          // Step 1: Optimize the user prompt into a detailed English prompt for light novel covers
          const optimizationPrompt = `
            Please translate and expand the following user request into a detailed, high-quality English prompt for an image generation model. 
            The goal is to create a stunning Japanese light novel cover illustration. 
            The prompt should be very descriptive, including details about:
            1.  **Character:** Appearance (hair color, eye color, clothing, expression), pose, and any special items they have.
            2.  **Background:** The setting (e.g., fantasy city, high school, magical forest), time of day, weather, and atmosphere.
            3.  **Art Style:** Specify "Japanese light novel cover illustration", "vibrant colors", "detailed line art", "anime style", and other relevant artistic keywords.
            4.  **Composition:** Mention dynamic angles, lighting effects (e.g., lens flare, soft glow), and overall mood (e.g., epic, romantic, mysterious).

            User Request: "${prompt}"

            Return ONLY the final, optimized English prompt, ready for the image model.
          `;
          
          let chatHistory = [{ role: "user", parts: [{ text: optimizationPrompt }] }];
          const payloadForOptimization = { contents: chatHistory };
          const apiKey = ""; 
          const apiUrlForOptimization = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
          
          const optimizationResponse = await fetch(apiUrlForOptimization, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payloadForOptimization)
          });

          if (!optimizationResponse.ok) {
            throw new Error('優化提示詞時發生錯誤。');
          }

          const optimizationResult = await optimizationResponse.json();
          if (!optimizationResult.candidates || !optimizationResult.candidates[0].content.parts[0].text) {
             throw new Error('無法從 API 獲取優化的提示詞。');
          }
          const generatedOptimizedPrompt = optimizationResult.candidates[0].content.parts[0].text.trim();
          setOptimizedPrompt(generatedOptimizedPrompt);


          // Step 2: Generate the image using the optimized prompt
          const payloadForImage = {
            instances: [{ prompt: generatedOptimizedPrompt }],
            parameters: {
              sampleCount: 1,
              aspectRatio: "9:16" // Set aspect ratio for light novel covers
            }
          };
          
          const apiUrlForImage = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
          
          const imageResponse = await fetch(apiUrlForImage, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payloadForImage)
          });
          
          if (!imageResponse.ok) {
            throw new Error('生成圖片時發生錯誤。');
          }

          const imageResult = await imageResponse.json();

          if (imageResult.predictions && imageResult.predictions.length > 0 && imageResult.predictions[0].bytesBase64Encoded) {
            const generatedImageUrl = `data:image/png;base64,${imageResult.predictions[0].bytesBase64Encoded}`;
            setImageUrl(generatedImageUrl);
          } else {
            throw new Error('圖片生成失敗，未收到有效的圖片資料。');
          }

        } catch (err) {
          setError(err.message || '發生未知錯誤，請稍後再試。');
          console.error(err);
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="bg-gradient-to-br from-purple-900 to-cyan-800 text-white min-h-screen flex flex-col items-center p-4 font-sans">
          <div className="w-full max-w-2xl mx-auto">
            <header className="text-center my-8">
              <h1 className="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-cyan-300">
                Gloria的輕小說情境圖創建
              </h1>
              <p className="text-gray-300 mt-4">
                輸入您的想法，AI 將為您創造專屬的輕小說風格封面。
              </p>
            </header>

            <main className="flex flex-col items-center gap-6">
              <div className="w-full">
                <textarea
                  value={prompt}
                  onChange={(e) => setPrompt(e.target.value)}
                  placeholder="例如：一個銀髮紅瞳的魔法師少年，在漂浮的空中圖書館閱讀古老的魔導書"
                  className="w-full h-28 p-4 bg-gray-800/50 backdrop-blur-sm border-2 border-gray-600 rounded-lg focus:outline-none focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400 transition-colors"
                />
              </div>

              <button
                onClick={handleGenerate}
                disabled={loading}
                className="w-full md:w-auto px-8 py-3 bg-gradient-to-r from-purple-500 to-cyan-500 text-white font-bold rounded-lg shadow-lg hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100 transition-transform duration-300"
              >
                {loading ? '生成中...' : '開始生成封面'}
              </button>

              {error && <p className="text-red-400 mt-4 bg-black/50 p-3 rounded-lg">{error}</p>}

              <div className="w-full mt-8 flex flex-col items-center gap-8">
                {loading && (
                  <div className="flex flex-col items-center justify-center gap-4">
                     <div className="w-16 h-16 border-4 border-dashed rounded-full animate-spin border-purple-400"></div>
                     <p className="text-gray-300">AI 正在全力繪製中，請稍候...</p>
                  </div>
                )}
                
                {imageUrl && !loading && (
                  <div className="w-full max-w-sm bg-black/30 backdrop-blur-md rounded-lg shadow-2xl p-4 border border-gray-700">
                     <img
                       src={imageUrl}
                       alt="Generated light novel cover"
                       className="w-full rounded-md object-contain"
                     />
                     <div className="mt-4">
                        <h3 className="text-lg font-bold text-purple-300">優化後的英文提示詞：</h3>
                        <p className="text-gray-300 bg-black/40 p-3 rounded-md mt-2 text-sm">
                          {optimizedPrompt}
                        </p>
                     </div>
                  </div>
                )}
              </div>
            </main>
          </div>
        </div>
      );
    }
    
    // Mount the React app to the root div
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<App />);

  </script>
</body>
</html>

